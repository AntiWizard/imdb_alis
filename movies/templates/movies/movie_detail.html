{% extends 'base.html' %}
{% load user_tag %}
{% block title %} {{ movie.title }} {% endblock %}

{% block content %}
    <div class="content">
        <div class="row m-5">
            <div class="col-md-4">
                <img src="{{ movie.avatar.url }}" alt="{{ movie.title }}" class="avatar">
            </div>
            <div class="col-md-8 p-2 column">
                <div class="row-md-2 mb-4">
                    <h2 class="text-center title"><i>{{ movie.title | title }}</i></h2>
                </div>
                <div class="row-md-2 mb-3">
                    <h4 class="text-left dark-mode">Genres:
                        {% if movie.genres.name %}
                            <span style="color:seashell;font-size: 24px" class="text-center">
                            {{ movie.genres }}
                        </span>
                        {% endif %}
                    </h4>
                </div>
                <div class="row-md-2 mb-3">
                    <h4 class="text-left dark-mode">Rate:
                        <span style="color:seashell;font-size: 24px" class="text-center">
                            {{ movie.rate|floatformat:2 }}
                        </span>
                    </h4>
                </div>
                <div class="row-md-2">
                    <h4 class="text-left dark-mode">Description:
                        <h5 style="color:seashell;text-indent: 50px;text-align: justify;">
                            {{ movie.get_description | capfirst }}
                        </h5>
                    </h4>
                </div>
                <br>
                <div class="row">
                    <div {% if crew %} class="col-md-3" {% endif %}>
                        <h4 class="text-left dark-mode">Actors: </h4>
                        {% for crew in crews %}
                            <div class="col-md-3">
                                {% if crew.avatar %}
                                    <img src="{{ crew.avatar.url }}" style="width: 100%;height: 100%"
                                         alt="{{ crew.last_name|add:crew.last_name }}">
                                {% endif %}
                                <h6 class="text-center" style="color: seashell;width: 100%;margin: auto">
                                    <b>{{ crew.first_name }} {{ crew.last_name }}</b></h6>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            {% for comment in comments %}
                <div class="card comment mb-2">
                    <h5 style="text-align: right;margin-right: 20px">
                        <i>{{ comment.parent.user|custom }}</i>
                    </h5>
                    <div>
                        <h6 style="color:currentColor;margin-left: 2%;margin-right: 2%">
                            {{ comment.parent.comment_body | capfirst }}
                        </h6>
                        <h5 style="text-align: right;margin-right: 20px">
                            <i>{{ comment.parent.modified_time }}</i>
                        </h5>
                    </div>

                    {#                                            {% for com in comment.parent %}#}
                    {#                                                <div class="card comment mb-2">#}
                    {#                                                    <h5 style="text-align: right;margin-right: 20px">#}
                    {#                                                        <i>{{ com.user|custom }}</i>#}
                    {#                                                    </h5>#}
                    {#                                                    <div>#}
                    {#                                                        <h6 style="color:currentColor;margin-left: 2%;margin-right: 2%">#}
                    {#                                                            {{ com.comment_body | capfirst }}#}
                    {#                                                        </h6>#}
                    {#                                                        <h5 style="text-align: right;margin-right: 20px">#}
                    {#                                                            <i>{{ com.modified_time }}</i>#}
                    {#                                                        </h5>#}
                    {#                                                    </div>#}
                    {#                                                </div>#}
                    {#                                            {% endfor %}#}

                    <form method="POST" class="form-inline" action="{% url 'movie_comment' movie.id comment.id %}">
                        {% csrf_token %}
                        {% if user.is_authenticated and comment.user == request.user %}
                            <a class="mr-1" style="margin-left: 2%"
                               href={% url "movie_comment" movie.id comment.id %}>
                                <button type="submit" class="btn btn-primary mb-2" name="edit" value="edit">Edit
                                </button>
                            </a>
                            <a href={% url "movie_comment" movie.id comment.id %}>
                                <button type="submit" class="btn btn-danger mb-2" name="delete" value="delete">Delete
                                </button>
                            </a>
                        {% endif %}
                        {% if comment.user != request.user %}
                            <a style="margin-left: 2%" href={% url "movie_comment" movie.id comment.id %}>
                                <button type="submit" class="btn btn-success mb-2" name="replay" value="replay">Replay
                                </button>
                            </a>
                        {% endif %}
                    </form>
                </div>
            {% endfor %}
        </div>

        {% if user.is_authenticated %}
            <a style="text-align: right" href={% url "movie_comment" movie.id 0 %}>
                <button type="submit" class="btn btn-light mb-2">New Comment</button>
            </a>
        {% endif %}
    </div>
{% endblock %}